#import "@preview/modern-g7-32:0.1.0": gost, abstract, title-templates, structure-heading
#import "@preview/tablex:0.0.8": tablex, hlinex, vlinex
#import "@preview/codly:1.3.0": *
#import "@preview/codly-languages:0.1.1": *
#show: codly-init.with()
#show raw: set text(size: 8pt)

#let lab-num = 5

#codly(zebra-fill: none, number-format: none, display-name: false)

#show: gost.with(
  title-template: title-templates.mai-university-lab,
  performers: (
    (name: "Елисеев П.А.", position: "Студент М3О-221Б-23"),
  ),
  institute: (number: 3, name: "Системы управления, информатика и электроэнергетика"),
  department: (number: 311, name: "Прикладные программные средства и математические методы"),
  about: [О лабораторной работе №#str(lab-num)],
  subject: ["ИНТЕРПОЛЯЦИЯ ТАБЛИЧНО ЗАДАННЫХ ФУНКЦИЙ"],
  city: "Москва",
  text-size: (default: 13pt, small: 10pt)
)

#set heading(numbering: "1.")

= Задание
Для функции $y = f(x)$, заданной таблично в узлах варианта №7:
1. Построить интерполяционный многочлен Лагранжа. Вычислить $L_n(x_1+x_2)$. Построить график многочлена Лагранжа.
2. Построить таблицы конечных и разделенных разностей.
3. Построить полином Ньютона и вычислить значение $N_n(x_1+x_2)$. Построить график многочлена Ньютона.

Данные варианта №7:
$ x = (0.235, 0.672, 1.385, 2.051, 2.908) $
$ y = (1.082, 1.805, 4.280, 5.011, 7.082) $
Число узлов $m+1 = 5$, следовательно, степень многочленов $n=4$.
Точка для вычисления: $x_c = x_1 + x_2 = 0.672 + 1.385 = 2.057$.

== 1. Интерполяционный многочлен Лагранжа

Многочлен Лагранжа $L_n(x)$ строится в виде линейной комбинации базисных многочленов $p_i(x)$:
$ L_n(x) = sum_(i=0)^n p_i(x) f(x_i) $, где
$ p_i(x) = product_(j=0, j!=i)^n (x - x_j) / (x_i - x_j) $

*Ручной расчет (пример для одного базисного многочлена $p_0(x)$):*
$ x_0=0.235, x_1=0.672, x_2=1.385, x_3=2.051, x_4=2.908 $
$ y_0=1.082 $
$ p_0(x) = ((x-x_1)(x-x_2)(x-x_3)(x-x_4)) / ((x_0-x_1)(x_0-x_2)(x_0-x_3)(x_0-x_4)) $
$ p_0(x) = ((x-0.672)(x-1.385)(x-2.051)(x-2.908)) / ((0.235-0.672)(0.235-1.385)(0.235-2.051)(0.235-2.908)) $
$ p_0(x) = ((x-0.672)(x-1.385)(x-2.051)(x-2.908)) / ((-0.437)(-1.150)(-1.816)(-2.673)) $
$ p_0(x) approx ((x-0.672)(x-1.385)(x-2.051)(x-2.908)) / (2.4361) $
Аналогично вычисляются остальные базисные многочлены $p_1(x), p_2(x), p_3(x), p_4(x)$. Затем они умножаются на соответствующие $y_i$ и суммируются для получения $L_4(x)$.

*Программная реализация:*
#raw(read("scripts/lagrange.py"), lang: "python", block: true)
```python
# Результат выполнения кода:
Узлы x: [0.235, 0.672, 1.385, 2.051, 2.908]
Узлы y: [1.082, 1.805, 4.28, 5.011, 7.082]
Точка для вычисления x1+x2 = 0.672 + 1.385 = 2.0570
L4(2.0570) = 5.0118181
График многочлена Лагранжа сохранен в images/lagrange_polynomial.png
```

#figure(
  image("images/lagrange_polynomial.png", width: 80%),
  caption: [Интерполяционный многочлен Лагранжа $L_4(x)$]
) <lab5_fig_L4>

Значение многочлена Лагранжа в точке $x_c = 2.057$ равно $L_4(2.057) approx 5.0118181$.

== 2. Таблицы конечных и разделенных разностей

*Конечные разности*
Для построения таблицы конечных разностей требуется, чтобы узлы $x_i$ были равноотстоящими. Проверим это для заданных узлов:
$x_1 - x_0 = 0.672 - 0.235 = 0.437$
$x_2 - x_1 = 1.385 - 0.672 = 0.713$
$x_3 - x_2 = 2.051 - 1.385 = 0.666$
$x_4 - x_3 = 2.908 - 2.051 = 0.857$
Так как шаги $h_i = x_(i+1) - x_i$ не равны между собой, узлы не являются равноотстоящими. Классическая таблица конечных разностей (использующая один шаг $h$) для этих данных не строится.

*Разделенные разности*
Разделенные разности $f[x_i, ..., x_(i+k)]$ вычисляются по рекуррентной формуле:
$ f[x_i] = y_i $
$ f[x_i, x_(i+1)] = (f[x_(i+1)] - f[x_i]) / (x_(i+1) - x_i) $
$ f[x_i, ..., x_(i+k)] = (f[x_(i+1), ..., x_(i+k)] - f[x_i, ..., x_(i+k-1)]) / (x_(i+k) - x_i) $

Результаты вычисления таблицы разделенных разностей (из программной реализации):
#table(
  columns: 7,
  align: center + horizon,
  [], [*$x_i$*], [*$y_i = f[x_i]$*], [*1-го порядка*], [*2-го порядка*], [*3-го порядка*], [*4-го порядка*],
  $i=0$, $0.235$, $1.0820$, $1.6545$, $1.5798$, $-1.8178$, $1.1129$,
  $i=1$, $0.672$, $1.8050$, $3.4712$, $-1.7213$, $1.1571$, [],
  $i=2$, $1.385$, $4.2800$, $1.0976$, $0.8660$, [], [],
  $i=3$, $2.051$, $5.0110$, $2.4166$, [], [], [],
  $i=4$, $2.908$, $7.0820$, [], [], [], [],
)
_Примечание: В таблице приведены значения $f[x_i, ..., x_(i+k)]$ на соответствующих позициях. Например, $1.6545 = f[x_0, x_1]$, $1.5798 = f[x_0, x_1, x_2]$ и т.д._

== 3. Интерполяционный многочлен Ньютона

Многочлен Ньютона $N_n(x)$ строится с использованием разделенных разностей:
$ N_n(x) = f[x_0] + f[x_0, x_1](x-x_0) + f[x_0, x_1, x_2](x-x_0)(x-x_1) + ... + f[x_0,...,x_n](x-x_0)...(x-x_(n-1)) $
Для $n=4$:
$ N_4(x) = a_0 + a_1(x-x_0) + a_2(x-x_0)(x-x_1) + a_3(x-x_0)(x-x_1)(x-x_2) + a_4(x-x_0)(x-x_1)(x-x_2)(x-x_3) $
где $a_0 = f[x_0]$, $a_1 = f[x_0, x_1]$, $a_2 = f[x_0, x_1, x_2]$, $a_3 = f[x_0, x_1, x_2, x_3]$, $a_4 = f[x_0, x_1, x_2, x_3, x_4]$.

Коэффициенты $a_i$ берутся из первой строки (диагонали) таблицы разделенных разностей:
$a_0 = 1.0820000$
$a_1 = 1.6544622$
$a_2 = 1.5798139$
$a_3 = -1.8177852$
$a_4 = 1.1129460$

*Ручной расчет (вычисление $N_4(2.057)$):*
#set block(below: 10pt)
$ x_c = 2.057 $
$ (x_c - x_0) = 2.057 - 0.235 = 1.822 $
$ (x_c - x_1) = 2.057 - 0.672 = 1.385 $
$ (x_c - x_2) = 2.057 - 1.385 = 0.672 $
$ (x_c - x_3) = 2.057 - 2.051 = 0.006 $

$ N_4(2.057) = a_0 $
$ quad + a_1 (x_c-x_0) $
$ quad + a_2 (x_c-x_0)(x_c-x_1) $
$ quad + a_3 (x_c-x_0)(x_c-x_1)(x_c-x_2) $
$ quad + a_4 (x_c-x_0)(x_c-x_1)(x_c-x_2)(x_c-x_3) $

$ N_4(2.057) = 1.0820000 $
$ quad + 1.6544622 * (1.822) $
$ quad + 1.5798139 * (1.822) * (1.385) $
$ quad + (-1.8177852) * (1.822) * (1.385) * (0.672) $
$ quad + 1.1129460 * (1.822) * (1.385) * (0.672) * (0.006) $

$ N_4(2.057) = 1.0820000 $
$ quad + 3.0141099 $ // $a_1 (x_c-x_0)$
$ quad + 3.9821879 $ // $a_2 (x_c-x_0)(x_c-x_1)$
$ quad - 3.0758340 $ // $a_3 (x_c-x_0)(x_c-x_1)(x_c-x_2)$
$ quad + 0.0106542 $ // $a_4 (x_c-x_0)(x_c-x_1)(x_c-x_2)(x_c-x_3)$
$ N_4(2.057) approx 1.0820 + 3.0141 + 3.9822 - 3.0758 + 0.0107 = 5.0132 $
_Примечание: Ручной расчет может немного отличаться из-за округлений промежуточных значений. Программный расчет точнее._

*Программная реализация:*
#raw(read("scripts/newton.py"), lang: "python", block: true)
```python
# Результат выполнения кода (часть, относящаяся к многочлену Ньютона):
--- Многочлен Ньютона ---
Коэффициенты (разделенные разности f[x0], f[x0,x1], ...):
a0 = 1.0820000
a1 = 1.6544622
a2 = 1.5798139
a3 = -1.8177852
a4 = 1.1129460
Точка для вычисления x1+x2 = 0.672 + 1.385 = 2.0570
N4(2.0570) = 5.0118181
График многочлена Ньютона сохранен в images/newton_polynomial.png
```

#figure(
  image("images/newton_polynomial.png", width: 80%),
  caption: [Интерполяционный многочлен Ньютона $N_4(x)$]
) <lab5_fig_N4>

Значение многочлена Ньютона в точке $x_c = 2.057$ равно $N_4(2.057) approx 5.0118181$.

== Вывод

В ходе лабораторной работы №5 для заданных 5 узлов интерполяции ($n=4$):
1.  Был построен интерполяционный многочлен Лагранжа $L_4(x)$. Значение многочлена в точке $x_c = x_1 + x_2 = 2.057$ составило $L_4(2.057) approx 5.0118181$. Построен график $L_4(x)$.
2.  Так как узлы $x_i$ не являются равноотстоящими, классическая таблица конечных разностей не была построена. Была вычислена и представлена таблица разделенных разностей.
3.  На основе таблицы разделенных разностей был построен интерполяционный многочлен Ньютона $N_4(x)$. Коэффициенты многочлена: $a_0=1.0820$, $a_1=1.6545$, $a_2=1.5798$, $a_3=-1.8178$, $a_4=1.1129$. Значение многочлена в точке $x_c = 2.057$ составило $N_4(2.057) approx 5.0118181$. Построен график $N_4(x)$.

Значения, полученные с помощью многочленов Лагранжа и Ньютона в контрольной точке $x_c=2.057$, совпадают ($approx 5.0118181$), что подтверждает теоретическое положение об единственности интерполяционного многочлена заданной степени для данного набора узлов. Визуально графики многочленов Лагранжа и Ньютона также идентичны.
