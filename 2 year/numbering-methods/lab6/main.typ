#import "@preview/modern-g7-32:0.1.0": gost, abstract, title-templates, structure-heading
#import "@preview/codly:1.3.0": *
#import "@preview/codly-languages:0.1.1": *
#show: codly-init.with()
#show raw: set text(size: 8pt)

#let lab-num = 6
#let var-num = 7

#codly(zebra-fill: none, number-format: none, display-name: false)

#show: gost.with(
  title-template: title-templates.mai-university-lab,
  performers: (
    (name: "Елисеев П.А.", position: "Студент М3О-221Б-23"), 
  ),
  institute: (number: 3, name: "Системы управления, информатика и электроэнергетика"),
  department: (number: 311, name: "Прикладные программные средства и математические методы"),
  about: [О лабораторной работе №#str(lab-num)],
  subject: ["АППРОКСИМАЦИЯ ФУНКЦИЙ МЕТОДОМ НАИМЕНЬШИХ КВАДРАТОВ"],
  city: "Москва",
  text-size: (default: 13pt, small: 10pt)
)
  
#set heading(numbering: "1.")

= Задание
Для варианта №#var-num:
1.  Нанести точки на график функции. Путем моделирования на компьютере из предложенных 10 аппроксимирующих законов выбрать два закона, которые на Ваш взгляд дадут наилучшую аппроксимацию по методу наименьших квадратов.
2.  Для каждого из двух выбранных законов составить нормальную систему уравнений, решив которую, найти параметры выбранных законов.
3.  Построить графики выбранных законов вместе с графиком исходной функции. Для каждого из аппроксимирующих законов найти невязку.

Данные варианта №7 (9 точек):
#table(
  columns: 10,
  align: center + horizon,
  [$x_i$], [$0.324$], [$0.645$], [$0.966$], [$1.287$], [$1.609$], [$1.930$], [$2.251$], [$2.572$], [$2.893$],
  [$y_i$], [$-2.052$], [$-1.756$], [$-1.076$], [$-0.284$], [$0.982$], [$2.209$], [$4.013$], [$5.796$], [$8.011$],
)

В качестве аппроксимирующих функций выбраны:
1. $phi_1(x) = a_1 x^2 + b_1 x + c_1$
2. $phi_2(x) = a_2 x + b_2 e^(-x) + c_2$

= Исходные данные и их визуализация
Начальные данные для аппроксимации представлены в таблице выше. График исходных точек показан на рисунке @lab6_fig1.

#figure(
  image("images/initial_data.png", width: 70%),
  caption: [График исходных данных варианта №7 (9 точек).]
) <lab6_fig1>

= Аппроксимация методом наименьших квадратов
Для нахождения коэффициентов аппроксимирующих функций используется метод наименьших квадратов (МНК).

== Аппроксимация функцией $phi_1(x) = a_1 x^2 + b_1 x + c_1$

=== Вывод системы нормальных уравнений
Метод наименьших квадратов заключается в минимизации суммы квадратов отклонений $S$:
$ S(a_1, b_1, c_1) = sum_(i=1)^n (y_i - (a_1 x_i^2 + b_1 x_i + c_1))^2 $
Приравнивая частные производные $S$ по $a_1, b_1, c_1$ к нулю, получаем систему нормальных уравнений:
$ cases(
  a_1 sum x_i^4 + b_1 sum x_i^3 + c_1 sum x_i^2 = sum y_i x_i^2 \
  a_1 sum x_i^3 + b_1 sum x_i^2 + c_1 sum x_i = sum y_i x_i \
  a_1 sum x_i^2 + b_1 sum x_i + c_1 n = sum y_i
) $
где $n=9$ - количество точек.

#pagebreak()
=== Ручной расчет сумм и формирование системы (для $phi_1(x)$)
Для формирования системы нормальных уравнений необходимо вычислить следующие суммы (расчеты проведены программно, см. скрипт `mnk.py`):
- $sum x_i = 14.477$
- $sum y_i = 15.843$
- $sum x_i^2 = 29.475941$
- $sum x_i^3 = 67.32297893$
- $sum x_i^4 = 163.85845504$
- $sum y_i x_i = 49.757414$
- $sum y_i x_i^2 = 134.07328735$

Подставляем вычисленные суммы в систему нормальных уравнений:
$ cases(
  163.8585 a_1 + 67.3230 b_1 + 29.4759 c_1 = 134.0733 \
  67.3230 a_1 + 29.4759 b_1 + 14.477 c_1 = 49.7574 \
  29.4759 a_1 + 14.477 b_1 + 9 c_1 = 15.843
) $
(Коэффициенты в системе округлены для отображения).

=== Программное решение системы и результаты
Скрипт на Python для вычислений коэффициентов и невязок приведен ниже.
#raw(read("scripts/mnk.py"), lang: "python", block: true)

*Результаты расчетов для $phi_1(x)$ (из вывода скрипта):*
```text
Матрица A1:
[[163.85845504  67.32297893  29.475941  ]
 [ 67.32297893  29.475941    14.477     ]
 [ 29.475941    14.477        9.        ]]
Вектор B1:
[134.07328735  49.757414    15.843     ]
Коэффициенты: a1 = 1.2523, b1 = -0.1065, c1 = -2.1698
Сумма квадратов остатков S1 = 0.026369
Невязка delta1 = 0.162386
coeffs_func1 = [1.2522786165289508, -0.10646674693457064, -2.169752391221911]
```
Таким образом, аппроксимирующая функция: $ phi_1(x) approx 1.252 x^2 - 0.107 x - 2.170 $
Невязка: $delta_1 approx 0.162386$.

#pagebreak()
== Аппроксимация функцией $phi_2(x) = a_2 x + b_2 e^(-x) + c_2$

=== Вывод системы нормальных уравнений для $phi_2(x)$ ===
Для аппроксимирующей функции $phi_2(x) = a_2 x + b_2 e^(-x) + c_2$, минимизируется сумма квадратов отклонений:
$ S(a_2, b_2, c_2) = sum_(i=1)^n (y_i - (a_2 x_i + b_2 e^(-x_i) + c_2))^2 $
Приравнивая частные производные по $a_2, b_2, c_2$ к нулю, получаем систему:
$ cases(
  a_2 sum x_i^2 + b_2 sum x_i e^(-x_i) + c_2 sum x_i = sum y_i x_i \
  a_2 sum x_i e^(-x_i) + b_2 sum e^(-2x_i) + c_2 sum e^(-x_i) = sum y_i e^(-x_i) \
  a_2 sum x_i + b_2 sum e^(-x_i) + c_2 n = sum y_i
) $
Значения этих сумм вычисляются программно в скрипте `mnk.py` и используются для формирования матрицы $A_2$ и вектора $B_2$.

*Результаты расчетов для $phi_2(x)$ (из вывода скрипта):*
```text
Матрица A2:
[[29.475941    2.49159023 14.477     ]
 [ 2.49159023  1.1005443   2.48693507]
 [14.477       2.48693507  9.        ]]
Вектор B2:
[49.757414   -1.06709308 15.843     ]
Коэффициенты: a2 = 6.4534, b2 = 10.3833, c2 = -11.4894
Сумма квадратов остатков S2 = 0.254595
Невязка delta2 = 0.504574
coeffs_func2 = [6.4533751329020115, 10.383276070196334, -11.489449462155681]
```
Таким образом, аппроксимирующая функция: $ phi_2(x) approx 6.453 x + 10.383 e^(-x) - 11.489 $.
Невязка: $delta_2 approx 0.504574$.

= Графики аппроксимирующих функций

Скрипт на Python для построения графиков аппроксимирующих функций и исходных данных:
#raw(read("scripts/graph.py"), lang: "python", block: true)

Результат работы скрипта `graph.py` (с подставленными коэффициентами) показан на рисунке @lab6_fig2.

#figure(
  image("images/approximation_plot.png", width: 80%),
  caption: [Графики аппроксимирующих функций $phi_1(x)$ и $phi_2(x)$ и исходные данные (9 точек).]
) <lab6_fig2>

#pagebreak()
= Вывод

В ходе лабораторной работы №6 была выполнена аппроксимация таблично заданной функции для варианта №7 (9 точек) методом наименьших квадратов. Были рассмотрены две аппроксимирующие функции:
1.  Параболическая функция: $phi_1(x) = a_1 x^2 + b_1 x + c_1$.
    Вывод системы нормальных уравнений был выполнен путем дифференцирования суммы квадратов отклонений. Суммы, входящие в систему, были рассчитаны программно и затем система была решена также программно.
    Получены коэффициенты: $a_1 approx 1.252$, $b_1 approx -0.107$, $c_1 approx -2.170$.
    Невязка составила $delta_1 approx 0.162386$.
2.  Линейная комбинация с экспонентой: $phi_2(x) = a_2 x + b_2 e^(-x) + c_2$.
    Система нормальных уравнений для этой функции была также выведена и решена программно.
    Получены коэффициенты: $a_2 approx 6.453$, $b_2 approx 10.383$, $c_2 approx -11.489$.
    Невязка составила $delta_2 approx 0.504574$.

Сравнивая невязки, можно заключить, что для данного набора из 9 точек параболическая функция $phi_1(x)$ дает значительно лучшую аппроксимацию ($delta_1 < delta_2$), так как ее невязка существенно меньше. Это также хорошо видно на графике @lab6_fig2, где кривая $phi_1(x)$ ближе проходит к исходным точкам.
Программная реализация позволила эффективно рассчитать коэффициенты и невязки для выбранных аппроксимирующих функций.
