#import "@preview/modern-g7-32:0.1.0": gost, abstract, title-templates, structure-heading
#import "@preview/codly:1.3.0": *
#import "@preview/codly-languages:0.1.1": *
#show: codly-init.with()
#show raw: set text(size: 8pt)

#let lab-num = 7

#codly(zebra-fill: none, number-format: none, display-name: false)

#show: gost.with(
  title-template: title-templates.mai-university-lab,
  performers: (
    (name: "Елисеев П.А.", position: "Студент М3О-221Б-23"),
  ),
  institute: (number: 3, name: "Системы управления, информатика и электроэнергетика"),
  department: (number: 311, name: "Прикладные программные средства и математические методы"),
  about: [О лабораторной работе №#str(lab-num)],
  subject: ["ЧИСЛЕННОЕ ИНТЕГРИРОВАНИЕ"],
  city: "Москва",
  text-size: (default: 13pt, small: 10pt)
)

#set heading(numbering: "1.")

= Задание
Для заданной функции $f(x) = 1 / (x^2 (x+1)^2)$ на отрезке $[1, 4]$:
1.  Вычислить интеграл методами трапеций и Симпсона.
2.  Оценить погрешность вычислений по правилу Рунге.
3.  Провести ручной расчет одного шага для каждого метода.

Точное значение интеграла:
$ I = integral_1^4 1 / (x^2 (x+1)^2) dif x $
Преобразуем подынтегральную функцию методом неопределенных коэффициентов:
$ 1 / (x^2 (x+1)^2) = A/x + B/x^2 + C/(x+1) + D/(x+1)^2 $
$ 1 = A x(x+1)^2 + B(x+1)^2 + C x^2(x+1) + D x^2 $
При $x=0: 1 = B(1)^2 => B=1$.
При $x=-1: 1 = D(-1)^2 => D=1$.
$ (x+1)^2 = x^2+2x+1 $.
$ x(x+1)^2 = x(x^2+2x+1) = x^3+2x^2+x $.
$ x^2(x+1) = x^3+x^2 $.
$ 1 = A(x^3+2x^2+x) + (x^2+2x+1) + C(x^3+x^2) + x^2 $
$ 1 = (A+C)x^3 + (2A+1+C+1)x^2 + (A+2)x + 1 $
$ 1 = (A+C)x^3 + (2A+C+2)x^2 + (A+2)x + 1 $
Сравнивая коэффициенты при степенях $x$:
$x^3: A+C = 0 => C = -A$
$x^2: 2A+C+2 = 0 => 2A-A+2 = 0 => A+2 = 0 => A = -2$
$C = -(-2) = 2$
$x^1: A+2 = 0 => -2+2 = 0$. Верно.

Итак, $ 1 / (x^2 (x+1)^2) = -2/x + 1/x^2 + 2/(x+1) + 1/(x+1)^2 $.
$ I = integral_1^4 (-2/x + 1/x^2 + 2/(x+1) + 1/(x+1)^2) dif x $
$ I = [-2ln|x| - 1/x + 2ln|x+1| - 1/(x+1)]_1^4 $
$ I = (-2ln(4) - 1/4 + 2ln(5) - 1/5) - (-2ln(1) - 1/1 + 2ln(2) - 1/2) $
$ I = (-2ln(4) - 0.25 + 2ln(5) - 0.2) - (0 - 1 + 2ln(2) - 0.5) $
$ I = -2ln(4) + 2ln(5) - 0.45 - (2ln(2) - 1.5) $
$ I = 2(ln(5) - ln(4)) - 2ln(2) - 0.45 + 1.5 $
$ I = 2ln(5/4) - 2ln(2) + 1.05 $
$ I = 2ln(5/4 \cdot 1/2) + 1.05 = 2ln(5/8) + 1.05 $
$ I = 1.05 + 2(ln(5) - ln(8)) approx 1.05 + 2(1.6094379 - 2.0794415) $
$ I approx 1.05 + 2(-0.4700036) = 1.05 - 0.9400072 approx 0.1099928 $
Точное значение интеграла $I_{"точн"} approx 0.1099927$.

#pagebreak()
== Программная реализация вспомогательных функций

#raw(read("scripts/functions.py"), lang: "python", block: true)

== Метод трапеций

Квадратурная формула трапеций:
$ I approx h/2 (y_0 + 2y_1 + ... + 2y_(n-1) + y_n) $
где $h = (b-a)/n$.

*Ручной расчет (n=2):*
Отрезок $[1, 4]$, $n=2$.
Шаг: $h = (4-1)/2 = 1.5$.
Узлы: $x_0 = 1, x_1 = 2.5, x_2 = 4$.
Значения функции в узлах:
$y_0 = f(1) = 1 / (1^2 (1+1)^2) = 1/4 = 0.25$
$y_1 = f(2.5) = 1 / (2.5^2 (2.5+1)^2) = 1 / (6.25 (3.5)^2) = 1 / (6.25 dot 12.25) = 1 / 76.5625 approx 0.01306122$
$y_2 = f(4) = 1 / (4^2 (4+1)^2) = 1 / (16 dot 25) = 1 / 400 = 0.0025$
$ I_("трап") (n=2) = h/2 (y_0 + 2y_1 + y_2) = 1.5/2 (0.25 + 2 dot 0.01306122 + 0.0025) $
$ I_("трап") (n=2) = 0.75 (0.25 + 0.02612244 + 0.0025) approx 0.2089668 $
(Данные из вывода скрипта Python).

#pagebreak()

*Программная реализация:*
#raw(read("scripts/trapezoid.py"), lang: "python", block: true)
```python
# Результат выполнения кода для метода трапеций:
--- Метод Трапеций ---
Число интервалов n = 20, Интеграл I_n = 0.1113855
Число интервалов 2n = 40, Интеграл I_2n = 0.1103427
Оценка погрешности для I_2n (Рунге): 3.476e-04
Абсолютная погрешность I_2n от точного: 3.499e-04
```
Погрешность метода трапеций оценивается по правилу Рунге ($p=2$):
$ R_("2n") approx abs(I_("2n") - I_n) / (2^p - 1) = abs(0.1103427 - 0.1113855) / (2^2 - 1) $
$ R_("2n") approx abs(-0.0010428) / 3 approx 0.0003476 $

#pagebreak()
== Метод Симпсона

Квадратурная формула Симпсона (n - четное):
$ I approx h/3 (y_0 + 4y_1 + 2y_2 + 4y_3 + ... + 2y_(n-2) + 4y_(n-1) + y_n) $
где $h = (b-a)/n$.

*Ручной расчет (n=2):*
Отрезок $[1, 4]$, $n=2$.
Шаг: $h = (4-1)/2 = 1.5$.
Узлы: $x_0 = 1, x_1 = 2.5, x_2 = 4$.
Значения функции в узлах:
$y_0 = 0.25$
$y_1 approx 0.01306122$
$y_2 = 0.0025$
$ I_("Симп") (n=2) = h/3 (y_0 + 4y_1 + y_2) = 1.5/3 (0.25 + 4 dot 0.01306122 + 0.0025) $
$ I_("Симп") (n=2) = 0.5 (0.25 + 0.05224488 + 0.0025) = 0.5 (0.30474488) approx 0.1523724 $
(Данные из вывода скрипта Python).

*Программная реализация:*
#raw(read("scripts/simpson.py"), lang: "python", block: true)
#pagebreak()
```python
# Результат выполнения кода для метода Симпсона:
--- Метод Симпсона ---
Число интервалов n = 20, Интеграл I_n = 0.1100275
Число интервалов 2n = 40, Интеграл I_2n = 0.1099951
Оценка погрешности для I_2n (Рунге): 2.160e-06
Абсолютная погрешность I_2n от точного: 2.317e-06
```
Погрешность метода Симпсона оценивается по правилу Рунге ($p=4$):
$ R_("2n") approx abs(I_("2n") - I_n) / (2^p - 1) = abs(0.1099951 - 0.1100275) / (2^4 - 1) $
$ R_("2n") approx abs(-0.0000324) / 15 approx 0.00000216 $

== Вывод

В ходе лабораторной работы №7 было проведено численное интегрирование функции $f(x) = 1 / (x^2 (x+1)^2)$ на отрезке $[1, 4]$ методами трапеций и Симпсона.
Точное значение интеграла: $I_{"точн"} = 1.05 + 2ln(5/8) approx 0.1099927$.

1.  *Метод трапеций*:
    -   При $n=20$, $I_n approx 0.1113855$.
    -   При $n=40$, $I_("2n") approx 0.1103427$.
    -   Оценка погрешности по правилу Рунге для $I_("2n")$: $R_("2n") approx 3.476 \cdot 10^(-4)$.
    -   Абсолютная погрешность $I_("2n")$ от точного значения: $approx 3.499 \cdot 10^(-4)$.

2.  *Метод Симпсона*:
    -   При $n=20$, $I_n approx 0.1100275$.
    -   При $n=40$, $I_("2n") approx 0.1099951$.
    -   Оценка погрешности по правилу Рунге для $I_("2n")$: $R_("2n") approx 2.160 \cdot 10^(-6)$.
    -   Абсолютная погрешность $I_("2n")$ от точного значения: $approx 2.317 \cdot 10^(-6)$.

Метод Симпсона показал значительно более высокую точность по сравнению с методом трапеций при одинаковом количестве интервалов $2n=40$. Оценка погрешности по правилу Рунге хорошо согласуется с фактической абсолютной погрешностью для обоих методов. Ручные расчеты для $n=2$ подтвердили правильность понимания формул.
Для данной функции и отрезка метод Симпсона является более эффективным для достижения заданной точности.