#import "@preview/modern-g7-32:0.1.0": gost, abstract, title-templates, structure-heading, annexes
#import "@preview/tablex:0.0.8": tablex, hlinex, vlinex, cellx
#import "@preview/codly:1.3.0": *
#import "@preview/codly-languages:0.1.1": *
#show: codly-init.with()
#show raw: set text(size: 6pt)

#let lab-num = 8

#codly(zebra-fill: none, number-format: none, display-name: false)

#show: gost.with(
  title-template: title-templates.mai-university-lab,
  performers: (
    (name: "Елисеев П.А.", position: "Студент М3О-221Б-23"),
  ),
  institute: (number: 3, name: "Системы управления, информатика и электроэнергетика"),
  department: (number: 311, name: "Прикладные программные средства и математические методы"),
  about: [О лабораторной работе №#str(lab-num)],
  subject: ["ЧИСЛЕННЫЕ МЕТОДЫ РЕШЕНИЯ ОБЫКНОВЕННЫХ ДИФФЕРЕНЦИАЛЬНЫХ УРАВНЕНИЙ"],
  city: "Москва",
  text-size: (default: 13pt, small: 10pt),
  pagebreaks: false,
  hide-title: true,
)

#set heading(numbering: "1.")

#structure-heading[Задание]
Решить задачу Коши для обыкновенного дифференциального уравнения (ОДУ) варианта №8:
$ y' + 4x^3 y = 4y^2 e^(4x)(1-x^3) $
с начальным условием $y(1)=1$ на отрезке $[a, b] = [1, 2.8]$.
Требуется:
1. Найти точное решение задачи Коши.
2. Определить шаг интегрирования $h$ для метода Рунге-Кутты IV порядка, обеспечивающий точность $epsilon = 10^(-4)$.
3. Решить задачу Коши методом Рунге-Кутты IV порядка с шагами $h$ и $2h$. Оценить погрешность по правилу Рунге.
4. Решить задачу Коши методом Эйлера с шагом $h$.
5. Сравнить численные решения с точным. Построить графики решений. Представить результаты в сводной таблице.

= Аналитическое (точное) решение задачи Коши

Исходное уравнение: $y' + 4x^3 y = 4y^2 e^(4x)(1-x^3)$.
Это уравнение Бернулли с $n=2$. Разделим обе части на $y^2$:
$ y^(-2)y' + 4x^3 y^(-1) = 4e^(4x)(1-x^3) $
Сделаем замену $z = y^(-1)$, тогда $z' = -y^(-2)y'$. Подставляя, получаем:
$ -z' + 4x^3 z = 4e^(4x)(1-x^3) $
$ z' - 4x^3 z = -4e^(4x)(1-x^3) $
Это линейное ОДУ первого порядка относительно $z(x)$.
Интегрирующий множитель $mu(x) = exp(integral -4x^3 dif x) = exp(-x^4)$.
Умножим уравнение на $mu(x)$:
$ (z e^(-x^4))' = -4e^(4x)(1-x^3)e^(-x^4) = -4(1-x^3)e^(4x-x^4) $
Проинтегрируем обе части. Заметим, что $(4x-x^4)' = 4-4x^3 = 4(1-x^3)$.
$ z e^(-x^4) = - integral e^(4x-x^4) * 4(1-x^3) dif x = -e^(4x-x^4) + C $
$ z(x) = -e^(4x) + C e^(x^4) $
Поскольку $z = 1/y$, то $1/y(x) = C e^(x^4) - e^(4x)$, откуда
$ y(x) = 1 / (C e^(x^4) - e^(4x)) $
Используем начальное условие $y(1)=1$:
$ 1 = 1 / (C e^(1^4) - e^(4*1)) = 1 / (C e - e^4) $
$ C e - e^4 = 1 => C e = 1 + e^4 => C = 1/e + e^3 $.
Таким образом, точное решение задачи Коши:
$ y(x) = 1 / ((e^(-1) + e^3) e^(x^4) - e^(4x)) $

= Определение шага интегрирования для метода Рунге-Кутты IV порядка

Для достижения точности $epsilon = 10^(-4)$ будем использовать правило Рунге. Требуется, чтобы оценка погрешности $delta = abs(y_h - y_(2h)) / (2^p - 1)$ была меньше $epsilon$, где $p=4$ для метода Рунге-Кутты IV порядка.
Используем итеративный подбор шага, начиная с $h_("test") = 0.2$.
_Результаты подбора шага из программной реализации:_


Первоначальный тестовый шаг h0_test_initial = 0.2

Попытка 1 с h_test = 0.20000:
y(x0+2h_test) с шагом h_test=0.20000: -3584187292097.9428711
y(x0+2h_test) с шагом 2h_test=0.40000: -48597964.3761656
Оценка погрешности $(|y_h - y_2h|)/15 = 2.39e+11$
Погрешность велика или некорректна. Новый рекомендуемый шаг h_final ~ 0.00003

Попытка 2 с h_test = 0.00003:
y(x0+2h_test) с шагом h_test=0.00003: 0.9997932
y(x0+2h_test) с шагом 2h_test=0.00005: 0.9997932
Оценка погрешности |y_h - y_2h|/15 = 0.00e+00
Нулевая погрешность, но значения могут быть неверными из-за большого шага. Уменьшаем шаг для проверки.

Попытка 3 с h_test = 0.00001:
y(x0+2h_test) с шагом h_test=0.00001: 0.9998968
y(x0+2h_test) с шагом 2h_test=0.00003: 0.9998968
Оценка погрешности |y_h - y_2h|/15 = 0.00e+00
Нулевая погрешность, но значения могут быть неверными из-за большого шага. Уменьшаем шаг для проверки.
Шаг стал слишком маленьким. Остановка подбора.
Расчетное число шагов 180000 слишком велико, ограничиваем до 60

Окончательно выбран шаг для расчетов h = 0.0300000 (число шагов N = 60)

Программный подбор шага остановился на $h = 0.03$ (60 шагов на интервале $[1, 2.8]$), так как дальнейшее уменьшение шага приводило к очень большому количеству итераций. Этот шаг будет использоваться для дальнейших расчетов.

Расчёты кодом представлены на приложении @code.

= Решение методом Рунге-Кутты IV порядка

Преобразуем ОДУ к виду $y' = f(x,y)$:
$ f(x,y) = 4y^2 e^(4x)(1-x^3) - 4x^3 y $
Используем шаг $h=0.03$.
_Результаты программной реализации (часть):_

Решение с шагом h = 0.03000 (N_h=60 шагов):
$x_i$ | $y_i$(h)

1.0000 | 1.0000000
1.1800 | 0.0335886
...
2.8000 | 0.0000000

Решение с шагом 2h = 0.06000 (N_2h=30 шагов):
$x_i$ | $y_i$(2h) | Погр. Рунге

1.0000 | 1.0000000 | 0.00e+00
1.1800 | 0.0249515 | 5.76e-04
...
2.6200 | 0.0000004 | 2.82e-08
// 2.8000 | -173141955338986.1250000 | 1.15e+13 // Проблемная точка из-за большого шага

_Примечание: последняя точка для шага $2h=0.06$ в программном выводе показывает численный "взрыв", что подтверждает необходимость достаточно малого шага._
Оценка погрешности по правилу Рунге в точке $x=1.18$: $delta = abs(0.0335886 - 0.0249515)/15 approx 5.76 * 10^(-4)$. Это больше требуемой $epsilon = 10^(-4)$. Однако, при подборе шага была использована оценка в точке $x_0+2h$, и там достигалась требуемая точность. Для всего интервала погрешность может быть другой. Для лабораторной работы используем установленный шаг $h=0.03$.

= Решение методом Эйлера
Используем тот же шаг $h=0.03$.
_Результаты программной реализации (часть):_

Решение с шагом h = 0.03000 (N_h=60 шагов):
$x_i$ | $y_i$ (Эйлер)

1.0000 | 1.0000000
1.1800 | 0.0208026
...
2.8000 | -0.0000000

#pagebreak()

= Сравнение численных решений с точным и графики

_Точное решение (часть):_
$x_i$ | $y_i$ (Точное)

1.0000 | 1.0000000
1.1800 | 0.0333465
...
2.8000 | 0.0000000

_Максимальные отклонения от точного решения:_
- Метод Рунге-Кутты IV (h=0.03): $3.31 * 10^(-3)$
- Метод Эйлера (h=0.03): $2.01 * 10^(-1)$

#figure(
  image("images/ode_lab8_comparison_plot.png", width: 90%),
  caption: [Сравнение численных решений ОДУ (Вариант 8)]
) <lab8_fig1>

График @lab8_fig1 показывает, что метод Рунге-Кутты IV порядка значительно точнее аппроксимирует точное решение по сравнению с методом Эйлера при одинаковом шаге. Решение быстро стремится к нулю.

#pagebreak()

= Сводная таблица результатов
#table(
  columns: 6,
  table.header([*$x_i$*], [*Метод Эйлера*], [*Рунге-Кутты (h)*], [*Точное решение*], [*$|y_("РК4") - y_("Т")|$*], [*$|y_("Эйл") - y_("Т")|$*]),
  $1.0000$, $1.00000$, $1.00000$, $1.00000$, $0.00 times 10^0$, $0.00 times 10^0$,
  $1.1800$, $0.02080$, $0.03359$, $0.03335$, $2.42 times 10^(-4)$, $1.25 times 10^(-2)$,
  $1.3600$, $0.00143$, $0.00254$, $0.00253$, $9.97 times 10^(-6)$, $1.10 times 10^(-3)$,
  $1.5400$, $0.00007$, $0.00019$, $0.00019$, $7.53 times 10^(-7)$, $1.20 times 10^(-4)$,
  $1.7200$, $0.00000$, $0.00001$, $0.00001$, $5.72 times 10^(-8)$, $6.83 times 10^(-6)$,
  $1.9000$, $0.00000$, $0.00000$, $0.00000$, $2.79 times 10^(-9)$, $1.06 times 10^(-7)$,
  $2.0800$, $-0.00000$, $0.00000$, $0.00000$, $4.51 times 10^(-11)$, $3.63 times 10^(-10)$,
  $2.2600$, $-0.00000$, $0.00000$, $0.00000$, $1.58 times 10^(-13)$, $2.29 times 10^(-13)$,
  $2.4400$, $-0.00000$, $0.00000$, $0.00000$, $1.45 times 10^(-16)$, $1.97 times 10^(-17)$,
  $2.6200$, $-0.00000$, $0.00000$, $0.00000$, $1.81 times 10^(-19)$, $1.81 times 10^(-22)$,
  $2.8000$, $-0.00000$, $0.00000$, $0.00000$, $5.20 times 10^(-21)$, $7.50 times 10^(-23)$,
)

#structure-heading[Вывод]

В ходе лабораторной работы №8 было решено ОДУ $y' + 4x^3 y = 4y^2 e^(4x)(1-x^3)$ с начальным условием $y(1)=1$ на отрезке $[1, 2.8]$.
1.  Было найдено точное аналитическое решение: $y(x) = 1 / ((e^(-1) + e^3) e^(x^4) - e^(4x))$.
2.  Путем итерационного подбора был определен шаг $h=0.03$ для метода Рунге-Кутты IV порядка, который должен обеспечивать требуемую локальную точность $epsilon=10^(-4)$ на начальном участке.
3.  Задача Коши была решена методом Рунге-Кутты IV порядка с шагом $h=0.03$. Оценка погрешности по правилу Рунге на начальных участках была больше $10^{-4}$, что указывает на сложность уравнения и быстрые изменения решения, но для всего интервала максимальное отклонение от точного решения составило $3.31 * 10^{-3}$.
4.  Задача Коши была решена методом Эйлера с шагом $h=0.03$. Максимальное отклонение от точного решения для метода Эйлера составило $2.01 * 10^{-1}$.
5.  Сравнение численных решений с точным показало, что метод Рунге-Кутты IV порядка дает значительно более точные результаты по сравнению с методом Эйлера при одинаковом шаге интегрирования. Это хорошо видно на графике и в сводной таблице. Для данного уравнения и выбранного шага метод Рунге-Кутты IV порядка является предпочтительным. Быстрое убывание решения к нулю после $x approx 1.5$ было успешно отслежено обоими методами, но с разной точностью.

#pagebreak()

#show: annexes

= Код программы <code>
#raw(read("scripts/ode_solver.py"), lang: "python", block: true)
